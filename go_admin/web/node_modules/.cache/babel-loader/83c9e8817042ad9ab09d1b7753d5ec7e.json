{"remainingRequest":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_babel-loader@8.2.2@babel-loader\\lib\\index.js!E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js??ref--0-0!E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js??vue-loader-options!E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\src\\view\\superAdmin\\authority\\components\\apis.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\src\\view\\superAdmin\\authority\\components\\apis.vue","mtime":1618795335792},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_babel-loader@8.2.2@babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkU6L0JhaWR1TmV0ZGlza0Rvd25sb2FkL2dpbi12dWUtYWRtaW4vd2ViL25vZGVfbW9kdWxlcy9fQGJhYmVsX3J1bnRpbWVANy4xMy4xMEBAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJFOi9CYWlkdU5ldGRpc2tEb3dubG9hZC9naW4tdnVlLWFkbWluL3dlYi9ub2RlX21vZHVsZXMvX0BiYWJlbF9ydW50aW1lQDcuMTMuMTBAQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCB7IGdldEFsbEFwaXMgfSBmcm9tICdAL2FwaS9hcGknOwppbXBvcnQgeyBVcGRhdGVDYXNiaW4sIGdldFBvbGljeVBhdGhCeUF1dGhvcml0eUlkIH0gZnJvbSAnQC9hcGkvY2FzYmluJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdBcGlzJywKICBwcm9wczogewogICAgcm93OiB7CiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uIF9kZWZhdWx0KCkgewogICAgICAgIHJldHVybiB7fTsKICAgICAgfSwKICAgICAgdHlwZTogT2JqZWN0CiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgYXBpVHJlZURhdGE6IFtdLAogICAgICBhcGlUcmVlSWRzOiBbXSwKICAgICAgbmVlZENvbmZpcm06IGZhbHNlLAogICAgICBhcGlEZWZhdWx0UHJvcHM6IHsKICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywKICAgICAgICBsYWJlbDogJ2Rlc2NyaXB0aW9uJwogICAgICB9CiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgbm9kZUNoYW5nZTogZnVuY3Rpb24gbm9kZUNoYW5nZSgpIHsKICAgICAgdGhpcy5uZWVkQ29uZmlybSA9IHRydWU7CiAgICB9LAogICAgLy8g5pq06Zyy57uZ5aSW5bGC5L2/55So55qE5YiH5o2i5oum5oiq57uf5LiA5pa55rOVCiAgICBlbnRlckFuZE5leHQ6IGZ1bmN0aW9uIGVudGVyQW5kTmV4dCgpIHsKICAgICAgdGhpcy5hdXRoQXBpRW50ZXIoKTsKICAgIH0sCiAgICAvLyDliJvlu7phcGnmoJHmlrnms5UKICAgIGJ1aWxkQXBpVHJlZTogZnVuY3Rpb24gYnVpbGRBcGlUcmVlKGFwaXMpIHsKICAgICAgdmFyIGFwaU9iaiA9IG5ldyBPYmplY3QoKTsKICAgICAgYXBpcyAmJiBhcGlzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGl0ZW0ub25seUlkID0gInA6IiArIGl0ZW0ucGF0aCArICJtOiIgKyBpdGVtLm1ldGhvZDsKCiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhcGlPYmosIGl0ZW0uYXBpR3JvdXApKSB7CiAgICAgICAgICBhcGlPYmpbaXRlbS5hcGlHcm91cF0ucHVzaChpdGVtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgT2JqZWN0LmFzc2lnbihhcGlPYmosIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaXRlbS5hcGlHcm91cCwgW2l0ZW1dKSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIGFwaVRyZWUgPSBbXTsKCiAgICAgIGZvciAodmFyIGtleSBpbiBhcGlPYmopIHsKICAgICAgICB2YXIgdHJlZU5vZGUgPSB7CiAgICAgICAgICBJRDoga2V5LAogICAgICAgICAgZGVzY3JpcHRpb246IGtleSArICfnu4QnLAogICAgICAgICAgY2hpbGRyZW46IGFwaU9ialtrZXldCiAgICAgICAgfTsKICAgICAgICBhcGlUcmVlLnB1c2godHJlZU5vZGUpOwogICAgICB9CgogICAgICByZXR1cm4gYXBpVHJlZTsKICAgIH0sCiAgICAvLyDlhbPogZTlhbPns7vnoa7lrpoKICAgIGF1dGhBcGlFbnRlcjogZnVuY3Rpb24gYXV0aEFwaUVudGVyKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgY2hlY2tBcnIsIGNhc2JpbkluZm9zLCByZXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY2hlY2tBcnIgPSBfdGhpcy4kcmVmcy5hcGlUcmVlLmdldENoZWNrZWROb2Rlcyh0cnVlKTsKICAgICAgICAgICAgICAgIGNhc2JpbkluZm9zID0gW107CiAgICAgICAgICAgICAgICBjaGVja0FyciAmJiBjaGVja0Fyci5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgdmFyIGNhc2JpbkluZm8gPSB7CiAgICAgICAgICAgICAgICAgICAgcGF0aDogaXRlbS5wYXRoLAogICAgICAgICAgICAgICAgICAgIG1ldGhvZDogaXRlbS5tZXRob2QKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgY2FzYmluSW5mb3MucHVzaChjYXNiaW5JbmZvKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gVXBkYXRlQ2FzYmluKHsKICAgICAgICAgICAgICAgICAgYXV0aG9yaXR5SWQ6IF90aGlzLmFjdGl2ZVVzZXJJZCwKICAgICAgICAgICAgICAgICAgY2FzYmluSW5mb3M6IGNhc2JpbkluZm9zCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAocmVzLmNvZGUgPT0gMCkgewogICAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJhcGnorr7nva7miJDlip8iCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpKCk7CiAgICB9CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciByZXMyLCBhcGlzLCByZXM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgIHJldHVybiBnZXRBbGxBcGlzKCk7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgcmVzMiA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIGFwaXMgPSByZXMyLmRhdGEuYXBpczsKICAgICAgICAgICAgICBfdGhpczIuYXBpVHJlZURhdGEgPSBfdGhpczIuYnVpbGRBcGlUcmVlKGFwaXMpOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICByZXR1cm4gZ2V0UG9saWN5UGF0aEJ5QXV0aG9yaXR5SWQoewogICAgICAgICAgICAgICAgYXV0aG9yaXR5SWQ6IF90aGlzMi5yb3cuYXV0aG9yaXR5SWQKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICBfdGhpczIuYWN0aXZlVXNlcklkID0gX3RoaXMyLnJvdy5hdXRob3JpdHlJZDsKICAgICAgICAgICAgICBfdGhpczIuYXBpVHJlZUlkcyA9IFtdOwogICAgICAgICAgICAgIHJlcy5kYXRhLnBhdGhzICYmIHJlcy5kYXRhLnBhdGhzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgX3RoaXMyLmFwaVRyZWVJZHMucHVzaCgicDoiICsgaXRlbS5wYXRoICsgIm06IiArIGl0ZW0ubWV0aG9kKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMik7CiAgICB9KSkoKTsKICB9Cn07"},{"version":3,"sources":["apis.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAmBA,SAAA,UAAA,QAAA,WAAA;AACA,SAAA,YAAA,EAAA,0BAAA,QAAA,cAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,MADA;AAEA,EAAA,KAAA,EAAA;AACA,IAAA,GAAA,EAAA;AACA,MAAA,OAAA,EAAA,oBAAA;AACA,eAAA,EAAA;AACA,OAHA;AAIA,MAAA,IAAA,EAAA;AAJA;AADA,GAFA;AAUA,EAAA,IAVA,kBAUA;AACA,WAAA;AACA,MAAA,WAAA,EAAA,EADA;AAEA,MAAA,UAAA,EAAA,EAFA;AAGA,MAAA,WAAA,EAAA,KAHA;AAIA,MAAA,eAAA,EAAA;AACA,QAAA,QAAA,EAAA,UADA;AAEA,QAAA,KAAA,EAAA;AAFA;AAJA,KAAA;AASA,GApBA;AAqBA,EAAA,OAAA,EAAA;AACA,IAAA,UADA,wBACA;AACA,WAAA,WAAA,GAAA,IAAA;AACA,KAHA;AAIA;AACA,IAAA,YALA,0BAKA;AACA,WAAA,YAAA;AACA,KAPA;AAQA;AACA,IAAA,YATA,wBASA,IATA,EASA;AACA,UAAA,MAAA,GAAA,IAAA,MAAA,EAAA;AACA,MAAA,IAAA,IACA,IAAA,CAAA,GAAA,CAAA,UAAA,IAAA,EAAA;AACA,QAAA,IAAA,CAAA,MAAA,GAAA,OAAA,IAAA,CAAA,IAAA,GAAA,IAAA,GAAA,IAAA,CAAA,MAAA;;AACA,YAAA,MAAA,CAAA,SAAA,CAAA,cAAA,CAAA,IAAA,CAAA,MAAA,EAAA,IAAA,CAAA,QAAA,CAAA,EAAA;AACA,UAAA,MAAA,CAAA,IAAA,CAAA,QAAA,CAAA,CAAA,IAAA,CAAA,IAAA;AACA,SAFA,MAEA;AACA,UAAA,MAAA,CAAA,MAAA,CAAA,MAAA,sBAAA,IAAA,CAAA,QAAA,EAAA,CAAA,IAAA,CAAA;AACA;AACA,OAPA,CADA;AASA,UAAA,OAAA,GAAA,EAAA;;AACA,WAAA,IAAA,GAAA,IAAA,MAAA,EAAA;AACA,YAAA,QAAA,GAAA;AACA,UAAA,EAAA,EAAA,GADA;AAEA,UAAA,WAAA,EAAA,GAAA,GAAA,GAFA;AAGA,UAAA,QAAA,EAAA,MAAA,CAAA,GAAA;AAHA,SAAA;AAKA,QAAA,OAAA,CAAA,IAAA,CAAA,QAAA;AACA;;AACA,aAAA,OAAA;AACA,KA9BA;AA+BA;AACA,IAAA,YAhCA,0BAgCA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,gBAAA,QADA,GACA,KAAA,CAAA,KAAA,CAAA,OAAA,CAAA,eAAA,CAAA,IAAA,CADA;AAEA,gBAAA,WAFA,GAEA,EAFA;AAGA,gBAAA,QAAA,IAAA,QAAA,CAAA,GAAA,CAAA,UAAA,IAAA,EAAA;AACA,sBAAA,UAAA,GAAA;AACA,oBAAA,IAAA,EAAA,IAAA,CAAA,IADA;AAEA,oBAAA,MAAA,EAAA,IAAA,CAAA;AAFA,mBAAA;AAIA,kBAAA,WAAA,CAAA,IAAA,CAAA,UAAA;AACA,iBANA,CAAA;AAHA;AAAA,uBAUA,YAAA,CAAA;AACA,kBAAA,WAAA,EAAA,KAAA,CAAA,YADA;AAEA,kBAAA,WAAA,EAAA;AAFA,iBAAA,CAVA;;AAAA;AAUA,gBAAA,GAVA;;AAcA,oBAAA,GAAA,CAAA,IAAA,IAAA,CAAA,EAAA;AACA,kBAAA,KAAA,CAAA,QAAA,CAAA;AAAA,oBAAA,IAAA,EAAA,SAAA;AAAA,oBAAA,OAAA,EAAA;AAAA,mBAAA;AACA;;AAhBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBA;AAjDA,GArBA;AAwEA,EAAA,OAxEA,qBAwEA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEA,UAAA,EAFA;;AAAA;AAEA,cAAA,IAFA;AAGA,cAAA,IAHA,GAGA,IAAA,CAAA,IAAA,CAAA,IAHA;AAKA,cAAA,MAAA,CAAA,WAAA,GAAA,MAAA,CAAA,YAAA,CAAA,IAAA,CAAA;AALA;AAAA,qBAMA,0BAAA,CAAA;AACA,gBAAA,WAAA,EAAA,MAAA,CAAA,GAAA,CAAA;AADA,eAAA,CANA;;AAAA;AAMA,cAAA,GANA;AASA,cAAA,MAAA,CAAA,YAAA,GAAA,MAAA,CAAA,GAAA,CAAA,WAAA;AACA,cAAA,MAAA,CAAA,UAAA,GAAA,EAAA;AACA,cAAA,GAAA,CAAA,IAAA,CAAA,KAAA,IAAA,GAAA,CAAA,IAAA,CAAA,KAAA,CAAA,GAAA,CAAA,UAAA,IAAA,EAAA;AACA,gBAAA,MAAA,CAAA,UAAA,CAAA,IAAA,CAAA,OAAA,IAAA,CAAA,IAAA,GAAA,IAAA,GAAA,IAAA,CAAA,MAAA;AACA,eAFA,CAAA;;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AAtFA,CAAA","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"clearflex\">\r\n      <el-button @click=\"authApiEnter\" class=\"fl-right\" size=\"small\" type=\"primary\">确 定</el-button>\r\n    </div>\r\n    <el-tree\r\n      :data=\"apiTreeData\"\r\n      :default-checked-keys=\"apiTreeIds\"\r\n      :props=\"apiDefaultProps\"\r\n      @check=\"nodeChange\"\r\n      default-expand-all\r\n      highlight-current\r\n      node-key=\"onlyId\"\r\n      ref=\"apiTree\"\r\n      show-checkbox\r\n    ></el-tree>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { getAllApis } from '@/api/api'\r\nimport { UpdateCasbin, getPolicyPathByAuthorityId } from '@/api/casbin'\r\nexport default {\r\n  name: 'Apis',\r\n  props: {\r\n    row: {\r\n      default: function() {\r\n        return {}\r\n      },\r\n      type: Object\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      apiTreeData: [],\r\n      apiTreeIds: [],\r\n      needConfirm:false,\r\n      apiDefaultProps: {\r\n        children: 'children',\r\n        label: 'description'\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    nodeChange(){\r\n      this.needConfirm = true\r\n    },\r\n    // 暴露给外层使用的切换拦截统一方法\r\n    enterAndNext(){\r\n      this.authApiEnter()\r\n    },\r\n    // 创建api树方法\r\n    buildApiTree(apis) {\r\n      const apiObj = new Object()\r\n      apis &&\r\n        apis.map(item => {\r\n        item.onlyId = \"p:\"+item.path+\"m:\"+item.method\r\n          if (Object.prototype.hasOwnProperty.call(apiObj,item.apiGroup)) {\r\n            apiObj[item.apiGroup].push(item)\r\n          } else {\r\n            Object.assign(apiObj, { [item.apiGroup]: [item] })\r\n          }\r\n        })\r\n      const apiTree = []\r\n      for (const key in apiObj) {\r\n        const treeNode = {\r\n          ID: key,\r\n          description: key + '组',\r\n          children: apiObj[key]\r\n        }\r\n        apiTree.push(treeNode)\r\n      }\r\n      return apiTree\r\n    },\r\n    // 关联关系确定\r\n    async authApiEnter() {\r\n      const checkArr = this.$refs.apiTree.getCheckedNodes(true)\r\n      var casbinInfos = []\r\n      checkArr&&checkArr.map(item=>{\r\n        var casbinInfo = {\r\n          path:item.path,\r\n          method:item.method\r\n        }\r\n        casbinInfos.push(casbinInfo)\r\n      })\r\n      const res = await UpdateCasbin({\r\n        authorityId: this.activeUserId,\r\n        casbinInfos\r\n      })\r\n      if (res.code == 0) {\r\n        this.$message({ type: 'success', message: \"api设置成功\" })\r\n      }\r\n    }\r\n  },\r\n  async created() {\r\n    // 获取api并整理成树结构\r\n    const res2 = await getAllApis()\r\n    const apis = res2.data.apis\r\n   \r\n    this.apiTreeData = this.buildApiTree(apis)\r\n    const res = await getPolicyPathByAuthorityId({\r\n      authorityId: this.row.authorityId\r\n    })\r\n    this.activeUserId = this.row.authorityId\r\n    this.apiTreeIds = []\r\n    res.data.paths&&res.data.paths.map(item=>{\r\n      this.apiTreeIds.push(\"p:\"+item.path+\"m:\"+item.method)\r\n    })\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n</style>"],"sourceRoot":"src/view/superAdmin/authority/components"}]}