{"remainingRequest":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js??vue-loader-options!E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\src\\view\\superAdmin\\authority\\components\\apis.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\src\\view\\superAdmin\\authority\\components\\apis.vue","mtime":1618795335792},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_babel-loader@8.2.2@babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\BaiduNetdiskDownload\\gin-vue-admin\\web\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBnZXRBbGxBcGlzIH0gZnJvbSAnQC9hcGkvYXBpJw0KaW1wb3J0IHsgVXBkYXRlQ2FzYmluLCBnZXRQb2xpY3lQYXRoQnlBdXRob3JpdHlJZCB9IGZyb20gJ0AvYXBpL2Nhc2JpbicNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0FwaXMnLA0KICBwcm9wczogew0KICAgIHJvdzogew0KICAgICAgZGVmYXVsdDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiB7fQ0KICAgICAgfSwNCiAgICAgIHR5cGU6IE9iamVjdA0KICAgIH0NCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgYXBpVHJlZURhdGE6IFtdLA0KICAgICAgYXBpVHJlZUlkczogW10sDQogICAgICBuZWVkQ29uZmlybTpmYWxzZSwNCiAgICAgIGFwaURlZmF1bHRQcm9wczogew0KICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywNCiAgICAgICAgbGFiZWw6ICdkZXNjcmlwdGlvbicNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBub2RlQ2hhbmdlKCl7DQogICAgICB0aGlzLm5lZWRDb25maXJtID0gdHJ1ZQ0KICAgIH0sDQogICAgLy8g5pq06Zyy57uZ5aSW5bGC5L2/55So55qE5YiH5o2i5oum5oiq57uf5LiA5pa55rOVDQogICAgZW50ZXJBbmROZXh0KCl7DQogICAgICB0aGlzLmF1dGhBcGlFbnRlcigpDQogICAgfSwNCiAgICAvLyDliJvlu7phcGnmoJHmlrnms5UNCiAgICBidWlsZEFwaVRyZWUoYXBpcykgew0KICAgICAgY29uc3QgYXBpT2JqID0gbmV3IE9iamVjdCgpDQogICAgICBhcGlzICYmDQogICAgICAgIGFwaXMubWFwKGl0ZW0gPT4gew0KICAgICAgICBpdGVtLm9ubHlJZCA9ICJwOiIraXRlbS5wYXRoKyJtOiIraXRlbS5tZXRob2QNCiAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGFwaU9iaixpdGVtLmFwaUdyb3VwKSkgew0KICAgICAgICAgICAgYXBpT2JqW2l0ZW0uYXBpR3JvdXBdLnB1c2goaXRlbSkNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihhcGlPYmosIHsgW2l0ZW0uYXBpR3JvdXBdOiBbaXRlbV0gfSkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICBjb25zdCBhcGlUcmVlID0gW10NCiAgICAgIGZvciAoY29uc3Qga2V5IGluIGFwaU9iaikgew0KICAgICAgICBjb25zdCB0cmVlTm9kZSA9IHsNCiAgICAgICAgICBJRDoga2V5LA0KICAgICAgICAgIGRlc2NyaXB0aW9uOiBrZXkgKyAn57uEJywNCiAgICAgICAgICBjaGlsZHJlbjogYXBpT2JqW2tleV0NCiAgICAgICAgfQ0KICAgICAgICBhcGlUcmVlLnB1c2godHJlZU5vZGUpDQogICAgICB9DQogICAgICByZXR1cm4gYXBpVHJlZQ0KICAgIH0sDQogICAgLy8g5YWz6IGU5YWz57O756Gu5a6aDQogICAgYXN5bmMgYXV0aEFwaUVudGVyKCkgew0KICAgICAgY29uc3QgY2hlY2tBcnIgPSB0aGlzLiRyZWZzLmFwaVRyZWUuZ2V0Q2hlY2tlZE5vZGVzKHRydWUpDQogICAgICB2YXIgY2FzYmluSW5mb3MgPSBbXQ0KICAgICAgY2hlY2tBcnImJmNoZWNrQXJyLm1hcChpdGVtPT57DQogICAgICAgIHZhciBjYXNiaW5JbmZvID0gew0KICAgICAgICAgIHBhdGg6aXRlbS5wYXRoLA0KICAgICAgICAgIG1ldGhvZDppdGVtLm1ldGhvZA0KICAgICAgICB9DQogICAgICAgIGNhc2JpbkluZm9zLnB1c2goY2FzYmluSW5mbykNCiAgICAgIH0pDQogICAgICBjb25zdCByZXMgPSBhd2FpdCBVcGRhdGVDYXNiaW4oew0KICAgICAgICBhdXRob3JpdHlJZDogdGhpcy5hY3RpdmVVc2VySWQsDQogICAgICAgIGNhc2JpbkluZm9zDQogICAgICB9KQ0KICAgICAgaWYgKHJlcy5jb2RlID09IDApIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZSh7IHR5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogImFwaeiuvue9ruaIkOWKnyIgfSkNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIGFzeW5jIGNyZWF0ZWQoKSB7DQogICAgLy8g6I635Y+WYXBp5bm25pW055CG5oiQ5qCR57uT5p6EDQogICAgY29uc3QgcmVzMiA9IGF3YWl0IGdldEFsbEFwaXMoKQ0KICAgIGNvbnN0IGFwaXMgPSByZXMyLmRhdGEuYXBpcw0KICAgDQogICAgdGhpcy5hcGlUcmVlRGF0YSA9IHRoaXMuYnVpbGRBcGlUcmVlKGFwaXMpDQogICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0UG9saWN5UGF0aEJ5QXV0aG9yaXR5SWQoew0KICAgICAgYXV0aG9yaXR5SWQ6IHRoaXMucm93LmF1dGhvcml0eUlkDQogICAgfSkNCiAgICB0aGlzLmFjdGl2ZVVzZXJJZCA9IHRoaXMucm93LmF1dGhvcml0eUlkDQogICAgdGhpcy5hcGlUcmVlSWRzID0gW10NCiAgICByZXMuZGF0YS5wYXRocyYmcmVzLmRhdGEucGF0aHMubWFwKGl0ZW09PnsNCiAgICAgIHRoaXMuYXBpVHJlZUlkcy5wdXNoKCJwOiIraXRlbS5wYXRoKyJtOiIraXRlbS5tZXRob2QpDQogICAgfSkNCiAgfQ0KfQ0K"},{"version":3,"sources":["apis.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"apis.vue","sourceRoot":"src/view/superAdmin/authority/components","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"clearflex\">\r\n      <el-button @click=\"authApiEnter\" class=\"fl-right\" size=\"small\" type=\"primary\">确 定</el-button>\r\n    </div>\r\n    <el-tree\r\n      :data=\"apiTreeData\"\r\n      :default-checked-keys=\"apiTreeIds\"\r\n      :props=\"apiDefaultProps\"\r\n      @check=\"nodeChange\"\r\n      default-expand-all\r\n      highlight-current\r\n      node-key=\"onlyId\"\r\n      ref=\"apiTree\"\r\n      show-checkbox\r\n    ></el-tree>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { getAllApis } from '@/api/api'\r\nimport { UpdateCasbin, getPolicyPathByAuthorityId } from '@/api/casbin'\r\nexport default {\r\n  name: 'Apis',\r\n  props: {\r\n    row: {\r\n      default: function() {\r\n        return {}\r\n      },\r\n      type: Object\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      apiTreeData: [],\r\n      apiTreeIds: [],\r\n      needConfirm:false,\r\n      apiDefaultProps: {\r\n        children: 'children',\r\n        label: 'description'\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    nodeChange(){\r\n      this.needConfirm = true\r\n    },\r\n    // 暴露给外层使用的切换拦截统一方法\r\n    enterAndNext(){\r\n      this.authApiEnter()\r\n    },\r\n    // 创建api树方法\r\n    buildApiTree(apis) {\r\n      const apiObj = new Object()\r\n      apis &&\r\n        apis.map(item => {\r\n        item.onlyId = \"p:\"+item.path+\"m:\"+item.method\r\n          if (Object.prototype.hasOwnProperty.call(apiObj,item.apiGroup)) {\r\n            apiObj[item.apiGroup].push(item)\r\n          } else {\r\n            Object.assign(apiObj, { [item.apiGroup]: [item] })\r\n          }\r\n        })\r\n      const apiTree = []\r\n      for (const key in apiObj) {\r\n        const treeNode = {\r\n          ID: key,\r\n          description: key + '组',\r\n          children: apiObj[key]\r\n        }\r\n        apiTree.push(treeNode)\r\n      }\r\n      return apiTree\r\n    },\r\n    // 关联关系确定\r\n    async authApiEnter() {\r\n      const checkArr = this.$refs.apiTree.getCheckedNodes(true)\r\n      var casbinInfos = []\r\n      checkArr&&checkArr.map(item=>{\r\n        var casbinInfo = {\r\n          path:item.path,\r\n          method:item.method\r\n        }\r\n        casbinInfos.push(casbinInfo)\r\n      })\r\n      const res = await UpdateCasbin({\r\n        authorityId: this.activeUserId,\r\n        casbinInfos\r\n      })\r\n      if (res.code == 0) {\r\n        this.$message({ type: 'success', message: \"api设置成功\" })\r\n      }\r\n    }\r\n  },\r\n  async created() {\r\n    // 获取api并整理成树结构\r\n    const res2 = await getAllApis()\r\n    const apis = res2.data.apis\r\n   \r\n    this.apiTreeData = this.buildApiTree(apis)\r\n    const res = await getPolicyPathByAuthorityId({\r\n      authorityId: this.row.authorityId\r\n    })\r\n    this.activeUserId = this.row.authorityId\r\n    this.apiTreeIds = []\r\n    res.data.paths&&res.data.paths.map(item=>{\r\n      this.apiTreeIds.push(\"p:\"+item.path+\"m:\"+item.method)\r\n    })\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n</style>"]}]}